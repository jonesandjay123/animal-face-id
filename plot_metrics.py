
import csv
import matplotlib.pyplot as plt
import io
import os

csv_data = """epoch,lr,train_loss,train_top1,train_top5,val_loss,val_top1,val_top5
1,0.0003,16.71484304017369,0.020775069916100678,0.023771474230922893,15.822823908791614,0.04757462686567164,0.06529850746268656
2,0.00029265847744427303,12.306846043704464,0.1152616859768278,0.17658809428685576,11.741037795792765,0.16417910447761194,0.2332089552238806
3,0.0002713525491562421,8.608551380875298,0.3006392329204954,0.41310427487015583,11.197499004762564,0.21361940298507462,0.32742537313432835
4,0.00023816778784387096,6.152916518488361,0.4532560926887735,0.5691170595285657,8.590434458718372,0.3460820895522388,0.47388059701492535
5,0.0001963525491562421,4.469237251754194,0.556931681981622,0.681781861765881,7.291877732348087,0.43283582089552236,0.5559701492537313
6,0.00015,3.1895978947996473,0.6512185377546944,0.7670795045944866,6.874480560644349,0.4449626865671642,0.5680970149253731
7,0.0001036474508437579,2.1468822124525397,0.7479025169796244,0.8337994406711946,6.207090534381012,0.48880597014925375,0.6268656716417911
8,6.183221215612905e-05,1.4052098017428525,0.8080303635637235,0.8839392728725529,5.79713923895537,0.5270522388059702,0.6464552238805971
9,2.86474508437579e-05,1.037018385306864,0.8497802636835797,0.9139033160207751,5.626309964194227,0.5326492537313433,0.6539179104477612
10,7.341522555726971e-06,0.8393581064043644,0.8679584498601678,0.9276867758689572,5.566578053716404,0.5438432835820896,0.664179104477612
1,0.0003,16.71484304017369,0.020775069916100678,0.023771474230922893,15.822823908791614,0.04757462686567164,0.06529850746268656
2,0.0002997040092642407,12.325785271891869,0.11506192568917299,0.17638833399920095,11.543939419646762,0.16884328358208955,0.24253731343283583
3,0.0002988172051971717,8.677445500839056,0.2964442668797443,0.4159009188973232,11.354997549484025,0.23414179104477612,0.33302238805970147
4,0.0002973430876093033,6.406179104620963,0.44007191370355575,0.5597283260087894,8.639634815614615,0.33488805970149255,0.47294776119402987
5,0.00029528747416929463,5.002190867472399,0.5245705153815422,0.6566120655213743,8.163020717563914,0.4076492537313433,0.5298507462686567
6,0.00029265847744427303,3.9208075034346908,0.6090691170595286,0.7275269676388334,8.72495560147869,0.35261194029850745,0.5111940298507462
7,0.0002894664728832377,2.9546684883520027,0.6737914502596883,0.7996404314822213,7.415628831777999,0.43470149253731344,0.5774253731343284
8,0.000285724057869903,2.363687223784218,0.7211346384338794,0.837594886136636,6.812396732728873,0.49533582089552236,0.6026119402985075
9,0.00028144600200657956,1.7905945146364828,0.7618857371154615,0.8787455053935278,7.021480531834844,0.4944029850746269,0.625
10,0.0002766491888253023,1.443761950343121,0.8024370755093887,0.9049141030763085,6.616565177689737,0.519589552238806,0.6296641791044776
11,0.00027135254915624217,1.1738417069768126,0.8222133439872154,0.9222932481022773,6.258292653667393,0.5307835820895522,0.6464552238805971
12,0.0002655769864163684,0.8996721869985723,0.8527766679984019,0.9458649620455454,6.769322067943971,0.523320895522388,0.6315298507462687
13,0.0002593452941132117,0.8317523653203375,0.867758689572513,0.9492608869356772,6.587188108643489,0.5093283582089553,0.6371268656716418
14,0.0002526820658893033,0.6398185459652092,0.8891330403515781,0.9638433879344787,6.4459008814683605,0.5326492537313433,0.6613805970149254
15,0.0002456135984623034,0.5258591431786526,0.9079105073911307,0.9704354774270875,6.133840354520883,0.5755597014925373,0.6791044776119403
16,0.00023816778784387096,0.5069119688800655,0.9085097882540951,0.9762285257690771,5.762831417482291,0.5811567164179104,0.7117537313432836
17,0.00023037401924684944,0.4308023960219828,0.9180982820615262,0.9786256492209349,6.359670831196344,0.5475746268656716,0.6781716417910447
18,0.00022226305111525726,0.38963964370742016,0.9278865361566121,0.9818218138234119,5.862257445036476,0.5774253731343284,0.6977611940298507
19,0.00021386689373476087,0.34312569614778127,0.9380743108270075,0.986016779864163,6.015154148215678,0.5960820895522388,0.6940298507462687
20,0.00020521868290270169,0.30843309838439387,0.9420695165801038,0.9874151018777467,5.499444029224453,0.6072761194029851,0.7098880597014925
21,0.00019635254915624208,0.28343674639344835,0.9500599280862965,0.9896124650419497,5.82703470116231,0.5970149253731343,0.7238805970149254
22,0.00018730348307472816,0.22917276704211356,0.9544546544147023,0.9910107870555334,5.3550973080877045,0.6305970149253731,0.7388059701492538
23,0.00017810719718785867,0.2069601524997796,0.9606472233320016,0.9910107870555334,5.552741904756916,0.625,0.7434701492537313
24,0.00016879998503464564,0.17482255231343505,0.9600479424690371,0.99460647223332,5.603828665035874,0.6268656716417911,0.7369402985074627
25,0.000159418577929397,0.13205800519506788,0.9724330803036356,0.9966040751098681,6.1011890724523745,0.6072761194029851,0.7145522388059702
26,0.00015,0.1519741318365347,0.9694366759888134,0.9948062325209748,5.153107778349919,0.648320895522388,0.7434701492537313
27,0.000140581422070603,0.12332921044449305,0.9776268477826608,0.9958050339592489,5.138480905276626,0.6613805970149254,0.7611940298507462
28,0.00013120001496535436,0.10104643620581888,0.980623252097483,0.9968038353975229,4.910335035466436,0.6623134328358209,0.7807835820895522
29,0.0001218928028121413,0.09656654317411949,0.9812225329604475,0.9970035956851778,4.9093476124663855,0.6725746268656716,0.7658582089552238
30,0.00011269651692527177,0.06997466502622621,0.9858170195765081,0.9982021574111066,4.724607994307333,0.6716417910447762,0.769589552238806
31,0.00010364745084375793,0.06195662888688792,0.9868158210147823,0.9982021574111066,4.806749948814733,0.6753731343283582,0.7723880597014925
32,9.478131709729836e-05,0.03255131509161732,0.9934079105073911,0.9992009588493808,4.468349214810044,0.6902985074626866,0.7947761194029851
33,8.61331062652391e-05,0.034514010621642575,0.9934079105073911,0.9992009588493808,4.503080012193367,0.6902985074626866,0.7882462686567164
34,7.773694888474269e-05,0.02874785720570146,0.9950059928086297,0.999001198561726,4.465126859607981,0.7033582089552238,0.7938432835820896
35,6.962598075315047e-05,0.008875273131343855,0.9972033559728326,0.9998002397123452,4.378543056658844,0.707089552238806,0.792910447761194
36,6.183221215612905e-05,0.015606427134833806,0.9968038353975229,0.9998002397123452,4.4113420479333225,0.6996268656716418,0.8022388059701493
37,5.438640153769654e-05,0.010416405563595467,0.9968038353975229,0.9996004794246903,4.382178900846794,0.7024253731343284,0.7994402985074627
38,4.73179341106967e-05,0.007594293974338287,0.9978026368357971,1.0,4.264129588853067,0.7126865671641791,0.8003731343283582
39,4.0654705886788306e-05,0.012328356042127763,0.9974031162604874,0.9998002397123452,4.188641142489305,0.7098880597014925,0.8078358208955224
40,3.4423013583631635e-05,0.017043252988626637,0.9974031162604874,0.9996004794246903,4.170760734757381,0.7285447761194029,0.8115671641791045
41,2.86474508437579e-05,0.005266906988639213,0.9982021574111066,1.0,4.224286342734721,0.7192164179104478,0.808768656716418
42,2.3350811174697774e-05,0.006888543861377516,0.9994007191370355,1.0,4.192797098586809,0.7238805970149254,0.808768656716418
43,1.8553997993420465e-05,0.005312463606197906,0.999001198561726,1.0,4.138675561591761,0.7248134328358209,0.8115671641791045
44,1.42759421300971e-05,0.008788435588841213,0.9992009588493808,0.9998002397123452,4.157324349702294,0.7285447761194029,0.8125
45,1.05335271167623e-05,0.007288015889591019,0.9986016779864163,0.9998002397123452,4.115677545319742,0.7248134328358209,0.8152985074626866
46,7.341522555726972e-06,0.0016151920829648825,0.9996004794246903,1.0,4.1643756752658352,0.726679104477612,0.816231343283582
47,4.712525830705356e-06,0.01005304598582881,0.9992009588493808,0.9998002397123452,4.127261752512918,0.7313432835820896,0.8125
48,2.656912390696692e-06,0.007068144412335645,0.9988014382740711,0.9998002397123452,4.142868536621777,0.726679104477612,0.8180970149253731
49,1.1827948028283352e-06,0.0068440948052841,0.9996004794246903,0.9998002397123452,4.132598325387756,0.7294776119402985,0.8171641791044776
50,2.9599073575926616e-07,0.014541620429439855,0.9986016779864163,0.9996004794246903,4.128534651514309,0.7276119402985075,0.8208955223880597
"""

lines = csv_data.strip().splitlines()
header_line = lines[0]
data_lines = lines[11:]

# The first line of the second block is also a header, so we skip it.
# Actually, it's not a header, it's data. Let's re-check the raw output.
# The raw output has the header once, then 10 lines of data, then the next 50 lines of data.
# So the line `1,0.0003,16.71484304017369...` is repeated.
# The first block is 1-10. The second block is 1-50.
# The first line of the second block is `1,0.0003,16.71484304017369...`
# The 11th line in the original string is `1,0.0003,16.71484304017369...`
# The 12th line is `2,0.0002997040092642407...`
# So I should start from line 11.
# The previous error was because I was reading the header from the wrong place.

header = header_line.split(',')
data_io = io.StringIO(os.linesep.join(data_lines))
reader = csv.reader(data_io)

data = {
    'epoch': [],
    'train_loss': [],
    'val_loss': [],
    'train_top1': [],
    'val_top1': []
}

# Find indices of the columns we need
epoch_idx = header.index('epoch')
train_loss_idx = header.index('train_loss')
val_loss_idx = header.index('val_loss')
train_top1_idx = header.index('train_top1')
val_top1_idx = header.index('val_top1')


for row in reader:
    data['epoch'].append(int(row[epoch_idx]))
    data['train_loss'].append(float(row[train_loss_idx]))
    data['val_loss'].append(float(row[val_loss_idx]))
    data['train_top1'].append(float(row[train_top1_idx]))
    data['val_top1'].append(float(row[val_top1_idx]))


# Create figure and subplots
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 10))
fig.suptitle('Chimpanzee Face ID Training Metrics (ResNet-18)', fontsize=16)

# Plotting Loss
ax1.plot(data['epoch'], data['train_loss'], label='Train Loss', marker='o')
ax1.plot(data['epoch'], data['val_loss'], label='Validation Loss', marker='o')
ax1.set_xlabel('Epoch')
ax1.set_ylabel('Loss')
ax1.set_title('Training and Validation Loss')
ax1.legend()
ax1.grid(True)

# Plotting Top-1 Accuracy
ax2.plot(data['epoch'], data['train_top1'], label='Train Top-1 Accuracy', marker='o')
ax2.plot(data['epoch'], data['val_top1'], label='Validation Top-1 Accuracy', marker='o')
ax2.set_xlabel('Epoch')
ax2.set_ylabel('Top-1 Accuracy')
ax2.set_title('Training and Validation Top-1 Accuracy')
ax2.legend()
ax2.grid(True)

plt.tight_layout(rect=[0, 0.03, 1, 0.95])
plt.savefig('docs/reports/chimp_resnet18_metrics.png')

print("Plot saved to docs/reports/chimp_resnet18_metrics.png")
